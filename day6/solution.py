import copy

def parse_input(inputs):
    return [list(i) for i in inputs.split()]

def part_1(inputs):
    grids = parse_input(inputs)
    simulation(grids)

def part_2(inputs):
    grids = parse_input(inputs)
    simulation2(grids)

def find_start(grids):
    for i in range(len(grids)):
        for j in range(len(grids[0])):
            if grids[i][j] == '^':
                return i, j
            
def simulation(grids):
    x, y = find_start(grids)
    row, col = len(grids), len(grids[0])
    direction = (
        (-1, 0), # up
        (0, 1),  # right
        (1, 0),  # down
        (0, -1), # left
    )
    current_dict = 0
    visited = set()
    visited.add((x,y,))
    while True:
        move = direction[current_dict%4]
        nx, ny = x + move[0], y + move[1]
        if nx < 0 or nx >= row or ny < 0 or ny >= col:
            break
        if grids[nx][ny] == '#':
            current_dict += 1 
            continue
        x, y = nx, ny
        visited.add((x, y))
    print(len(visited))

def simulation2(grids):
    x, y = find_start(grids)

    row, col = len(grids), len(grids[0])
    direction = (
        (-1, 0), # up
        (0, 1),  # right
        (1, 0),  # down
        (0, -1), # left
    )
    result = set()
    # visited = set()
    # visited[(x,y,)] = set([0]) # up
    for i in range(row):
        for j in range(col):
            if grids[i][j] == '#':
                continue
            # change i, j to '#', and see if it will loop;
            tmp, grids[i][j] = grids[i][j], '#'
            if search(x, y, 0, direction, set(), grids):
                result.add((i, j))
            grids[i][j] = tmp
        # x, y = nx, ny
    for r in result:
        grids[r[0]][r[1]] = 'O'
    for line in grids:
        print(''.join(line))

    print(len(result))

def search(x, y, current_dict, direction, visited, grids):
    row, col = len(grids), len(grids[0])
    while True:
        move = direction[current_dict%4]
        nx, ny = x + move[0], y + move[1]
        if nx < 0 or nx >= row or ny < 0 or ny >= col:
            return False
        if grids[nx][ny] == '#':
            current_dict += 1 
            continue
        if (x,y, current_dict %4) in visited:
            # if (current_dict%4) in visited[(x,y)]:
            return True
            # if turn at current location is visited, means put an object at nx, ny will 
            # create a loop

        visited.add((x,y, current_dict%4,))
        x, y = nx, ny

small_input = """....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#..."""
# part_1(small_input)
part_2(small_input)


inputs="""................#......#...........#...........................#......#...........#........................................#......
.......................................................................................#........#............#.............#.....#
#.......................#...#..........#...........#........#.......................#............#................................
.............#...............................................#........#................................#....#......#..............
...#..................................#......................#....#....................................#.................#........
...................#.....#......#...........#............................#......................#.#........................#......
...........................#..#...........#.............................#.........#.##.............#..............................
.#.................#................#..........##.........##..............#...................................................#...
...............................#......................#........#.......................#.........#...........#....................
...................................#................#.............................................................................
..#...............##.......#................#.#......#...........#................................................................
....#.#.....#..............#........##........................##...........................................#...............#......
.....................#..........#.................................#.....................................#.........................
..............#.........................................##......#.......................#..............#.................#..#.....
...........#...#..........................................................#.......#.............................#................#
................................#.#...............#...............................#..............##...............................
.........................................................#............#......................................#.................#..
......#.#....#.................................#....###..................#......#.........#....#..................................
..............#...................................#..........#............#.......#...............................................
..............#......#...............#.............................................#.............................................#
....#.#..............#................#......................................................................#....................
........................................................#...........#..#.#.....................#....#.....#........#...#.......#..
..............#.......#................#............................#..#.......#.........#...........#...#...#....#....#.....#....
...#...............................................................................................#..#..#..........#.............
.......#.........#..###..................................##...............##..#.......................#..........#...........#...#
.......#.....................#.............#...........#...............................................#.................#........
..........#............................#..............................#......#..#.........#...............................#.......
.............................#...............#............#..............................................................#........
...........#...................#......#......................#.......................#...............#......#.....................
..#..............................................#.........................#.............#...#.#..................................
................#.............................#....................................#.....#...................#..#.....#...........
#............................#...#........................#................#....#.............................................#...
...............#.............#........#...................................................................#.......#....#..#.......
...........#......#.....#........................#.#..........................................#............#......................
.#.....................................................#...............#.........................#................#...........#...
.........................................#.............#......#.#....................................................#.........#..
................................#...#......................................................#..........................#..........#
.#.........................#..............#.#.....................................................................................
.........#..........#.............##.........#..#.................#........................#.....#.##....................#........
...................................................................................#...........................................#..
................#..........................................#...#...#.................................................#.........#..
..............................................#..............#..................#......#...#....#..#..............................
......#......#.................#.............#..................#...............#.............#..................#...............#
.................................#.......#......#.......#.............................................................#........#..
..................#......#...................................#.................#.......#..........................................
....................#.........#.........................#..........#..........#..................#................................
..........#...........#...............#.#..................................................................................#......
..................#..#....................................................#..........#......#................................#....
............#.................................................................................................#........#..........
.........#...............................................#.........##...........................#.................................
...#.........#........................................................#....................................#......................
........#......................#......#............#........#...............#.......................#.............................
.......#..............................................................................................#....................#......
.#.#..........#.......#.............##......................#..........................................................#..........
............#.#...........#............................................................#..........................................
............#..........................................................................#....................#...............#.....
.......................#.....#...#........................................#.......#.........#.........................#...........
....................#..............#......#.......................................................................................
......................#....................................................................#...............#...#............#.....
........#..........#....................#...#........#......#..........................#....#..................#..#...............
................#...........................................................................................................#.....
.#...............#..........................................................................................#......#..#.#.........
..............#................#...............#.........#.........#................................#.#...........................
...#................#..............#........................#...#.......................................#.#.......................
#.........................................#..#....................................................................#...............
.............#...........#.......#.#.....................................................................#.....#..................
.............#..............................................................................#.....................................
........................#........#....#........#.#.............................................^..........#.......................
...............................#.......................................................#.............##.......#.......#...........
#.#..............#..........................................#.......#..........................................#..................
...##...............................#........#.............##..................................................#..................
..#..#.................................................................#............#...#...#.....................................
....................#.#...#............#.......#.............#.......#..............#.............................................
..#..#.........#.............................................................................#......................#...#.........
....................................................#.........................#..#...#.#.#......#...............................#.
......#.....#.....................................................................#..............................................#
....................#........#..........................................................#.......#........................#........
................#.........................#...........................#...........................................#..............#
..#.......#..................................................#..................................#.................................
..........#.....................#...#.#...........#....................................#..........................................
.....................................#...........................................................#..........#...................#.
....#............................#.........................................#.........................#............................
......#............#...........#......#.#..................................#......................................................
..................#.......#.....#......#.................................................................#................#.......
...........#.....#........................................................#.............#.........................................
.................................#...........................#........#.........#............#.............................#.....#
..#........................#.................................#....................................................................
......................................................................................................#........#.#...#............
#............................#..........#.#.....................#.............................................................#...
.......#.......#................#..........#..........................#........#....#...#........................................#
....#.....#..........................................................#.........................#....................#..#.......#..
.......#.............#.................................#...................................................................#......
...............#.......................................#.#...............................#.#..........#...........................
....#......#...#.#.........................#...............#...........#.......#........................................#..#......
...................#.........................................#.....................................................#..#.....#...#.
....#......#.#.............................#..........##........#......................#.#.......................#....#...........
........#.........................#........#.#..........................##..............#....#....................................
.............#.....#..........#.....#.......#..##...#.....................#..................................#....................
....#....#...........................#...........#....................#.....#.......#....#.........#.....#....#...................
............#...#....................#..........#.......#......#............#.........................#............##.............
.....................#.................................................................####.......................................
...#...........................................................................#......#..............#....#.......#...............
....#...#...#.....................#.............#..............................#...................#...........#..................
............................#...........#........#.............#..................................................................
...#.....#......#.....................#...........................................#...........#........#..........................
.................#...........................#................................................................#..........#........
.....................#........#...#...................................................................................#......#....
.#...............................#...#....#.................#...#......#..........................................................
....................#..........#.........................................#....................#.........#.........................
.......#.............#............#................#..........#.#.#.....................#............#.....................#......
......................#.........................#.................#...........................#................#..................
...#....#..........................#.#..##.................#..#..........#..............................................#.........
...........#.........................................................................................#.............#..............
..............#.................##...........#..#.............................................#..............................#....
...............................................##.......#..#.....#........#...#.............#.....................#...............
........#...................#...........#...............................#............................................#........#...
...................................#.....#......................#...#.........##..#...................#.#.........................
............#...........##............#.......................#.....#.......#...................#.................................
..#..#..............................#.......#.........#.....................................#.............#..#.................#..
..................#..................#..........................##..................#...#.......#.........#..................#....
.........#.........#..............................................#...........................................................#...
......................#...........#..................................#............................#......#.....#..................
.....#....#......#..................#.....#..............#.............................................#.....#....................
..............##...........#........................................................................#........#.#..................
..........#...............................##.......#............#.#.........#.....................................#....#..........
.................................#..............#.............................#........................................#..........
....................#.................#..........#..............#.......................#...................................#.....
............#..............................#.............................#......#......#......................#...#...............
.#..........#...............#..................................................................#....#.............................
....#............................................#......#..................#.....#............#.........................#........."""

# part_1(inputs)
part_2(inputs)